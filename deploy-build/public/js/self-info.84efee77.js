(self.webpackChunk_fiora_web=self.webpackChunk_fiora_web||[]).push([[256],{88027:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var r=n(67294),a=n(733),o=n.n(a),i=n(55761),c=(n(74063),n(14494)),l=n(58600),s=n(10676),u=n(28362),p=n(94262),m=n(16153),f=n(42007),v=n(21902),d=n(51649),h=n(37034),g=n(71280),b=n(93379),x=n.n(b),w=n(88161),Z={insert:"head",singleton:!1};x()(w.Z,Z);const E=w.Z.locals||{};var y=n(83778);function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,a,o=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(e){c=!0,a=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw a}}return o}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var R=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{l(r.next(e))}catch(e){o(e)}}function c(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}l((r=r.apply(e,t||[])).next())}))};const A=function(e){var t=e.visible,n=e.onClose,a=(0,h.Z)(),b=(0,c.v9)((function(e){var t;return null===(t=e.user)||void 0===t?void 0:t._id})),x=(0,c.v9)((function(e){var t;return null===(t=e.user)||void 0===t?void 0:t.avatar})),w=(0,c.v9)((function(e){return e.status.primaryColor})),Z=N((0,r.useState)(!1),2),k=Z[0],A=Z[1],C=N((0,r.useState)({enable:!1,src:"",ext:""}),2),S=C[0],I=C[1],O=(0,r.useRef)(null);function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"png";return R(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return A(!0),n.prev=1,n.next=4,(0,u.ZP)(e,"Avatar/".concat(b,"_").concat(Date.now(),".").concat(t));case 4:return r=n.sent,n.next=7,(0,d.mk)(r);case 7:n.sent&&(a.setAvatar(URL.createObjectURL(e)),v.Z.success("修改头像成功")),n.next=15;break;case 11:n.prev=11,n.t0=n.catch(1),console.error(n.t0),v.Z.error("上传头像失败");case 15:return n.prev=15,A(!1),I({enable:!1,src:"",ext:""}),n.finish(15);case 19:case"end":return n.stop()}}),n,null,[[1,11,15,19]])})))}function H(e){a.logout(),window.localStorage.removeItem("token"),v.Z.success(e),g.Z.disconnect(),g.Z.connect()}var Y=N((0,r.useState)(""),2),_=Y[0],j=Y[1],B=N((0,r.useState)(""),2),F=B[0],J=B[1],U=N((0,r.useState)(""),2),L=U[0],X=U[1];return r.createElement(p.Z,{className:E.selfInfo,visible:t,title:"个人信息设置",onClose:function(e){"rc-dialog-close-x"!==e.target.className&&S.enable||n()}},r.createElement("div",{className:y.Z.container},r.createElement("div",{className:y.Z.block},r.createElement("p",{className:y.Z.title},"修改头像"),r.createElement("div",{className:E.changeAvatar},S.enable?r.createElement("div",{className:E.cropper},r.createElement(i.Z,{className:k?"blur":"",ref:O,src:S.src,style:{width:0,height:0,paddingBottom:"50%"},aspectRatio:1}),r.createElement(m.Z,{className:E.button,onClick:function(){var e=this;O.current.getCroppedCanvas().toBlob((function(t){return R(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:T(t,S.ext);case 1:case"end":return e.stop()}}),e)})))}))}},"修改头像"),r.createElement(o(),{className:"".concat(E.loading," ").concat(k?"show":"hide"),type:"spinningBubbles",color:"rgb(".concat(w),height:120,width:120})):r.createElement("div",{className:E.preview},r.createElement("img",{className:k?"blur":"",alt:"头像预览",src:(0,u.uZ)(x),onClick:function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.Z)("blob","image/png,image/jpeg,image/gif");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return");case 5:if(!(t.length>l.Z.maxAvatarSize)){e.next=7;break}return e.abrupt("return",v.Z.error("设置头像失败, 请选择小于1.5MB的图片"));case 7:"gif"===t.ext?T(t.result,t.ext):((n=new FileReader).readAsDataURL(t.result),n.onloadend=function(){I({enable:!0,src:n.result,ext:t.ext})});case 8:case"end":return e.stop()}}),e)})))}}),r.createElement(o(),{className:"".concat(E.loading," ").concat(k?"show":"hide"),type:"spinningBubbles",color:"rgb(".concat(w),height:80,width:80})))),r.createElement("div",{className:y.Z.block},r.createElement("p",{className:y.Z.title},"修改密码"),r.createElement("div",null,r.createElement(f.Z,{className:E.input,value:_,onChange:j,type:"password",placeholder:"旧密码"}),r.createElement(f.Z,{className:E.input,value:F,onChange:J,type:"password",placeholder:"新密码"}),r.createElement(m.Z,{className:E.button,onClick:function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.Cp)(_,F);case 2:e.sent&&(n(),H("修改密码成功, 请使用新密码重新登录"));case 4:case"end":return e.stop()}}),e)})))}},"确认修改"))),r.createElement("div",{className:y.Z.block},r.createElement("p",{className:y.Z.title},"修改用户名"),r.createElement("div",null,r.createElement(f.Z,{className:E.input,value:L,onChange:X,type:"text",placeholder:"用户名"}),r.createElement(m.Z,{className:E.button,onClick:function(){return R(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,d.JC)(L);case 2:e.sent&&(n(),H("修改用户名成功, 请使用新用户名重新登录"));case 4:case"end":return e.stop()}}),e)})))}},"确认修改")))))}},88161:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(23645),a=n.n(r)()((function(e){return e[1]}));a.push([e.id,".selfInfo--WRYFn {\n  height: initial !important;\n  width: 500px;\n}\n.changeAvatar--3ZEmO {\n  position: relative;\n}\n.changeAvatar--3ZEmO .blur--3ZNOx {\n  -webkit-filter: blur(2px);\n          filter: blur(2px);\n}\n.cropper--2EIRX > div {\n  margin-bottom: 8px;\n}\n.cropper--2EIRX .loading--3nSeA {\n  top: 170px;\n  left: 170px;\n}\n.preview--tHYTJ > img {\n  width: 100px;\n  height: 100px;\n  cursor: pointer;\n}\n.preview--tHYTJ > img:hover {\n  -webkit-filter: blur(3px);\n          filter: blur(3px);\n}\n.preview--tHYTJ .loading--3nSeA {\n  top: 10px;\n  left: 10px;\n}\n.loading--3nSeA {\n  position: absolute;\n  pointer-events: none;\n}\n.input--1F-iT {\n  height: 36px;\n  margin-bottom: 8px;\n}\n.button--3IeHR {\n  width: 100px;\n  height: 36px;\n}\n",""]),a.locals={selfInfo:"selfInfo--WRYFn",changeAvatar:"changeAvatar--3ZEmO",blur:"blur--3ZNOx",cropper:"cropper--2EIRX",loading:"loading--3nSeA",preview:"preview--tHYTJ",input:"input--1F-iT",button:"button--3IeHR"};const o=a}}]);